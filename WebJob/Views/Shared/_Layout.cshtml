@using WebJob.Common
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TechJobs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900,900i&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,300i,400,400i,700,700i&display=swap" rel="stylesheet" />

    <!-- Bootstrap CSS (local - ensure this path exists) -->
    <link rel="stylesheet" href="@Url.Content("~/Content/assets/css/bootstrap.min.css")" />

    <!-- Plugin CSS -->
    <link rel="stylesheet" href="@Url.Content("~/Content/assets/css/select2.min.css")" />
    <link rel="stylesheet" href="@Url.Content("~/Content/assets/css/owlcarousel/owl.carousel.min.css")" />
    <link rel="stylesheet" href="@Url.Content("~/Content/assets/css/owlcarousel/owl.theme.default.min.css")" />

    <!-- App CSS -->
    <link rel="stylesheet" href="@Url.Content("~/Content/assets/css/style.css")" />
    <link rel="stylesheet" href="@Url.Content("~/Content/assets/css/main.css")" />
    <link rel="stylesheet" href="@Url.Content("~/Content/assets/css/Style1.css")" />

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet" />

    @Scripts.Render("~/bundles/modernizr")

    <style>
        /* Important inline styles from original */
        #chatBox {
            transition: all 0.3s ease-in-out;
        }

        #chatIcon:hover {
            transform: scale(1.1);
            transition: transform 0.2s;
        }

        .notification-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: red;
            color: #fff;
            border-radius: 50%;
            padding: 0 6px;
            font-size: 12px;
            line-height: 20px;
        }

        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: none;
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background-color: #007bff;
            color: white;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
        }

            .back-to-top:hover {
                background-color: #0056b3;
            }
    </style>
</head>
<body>

    <!-- main nav -->
    <div class="container-fluid fluid-nav ">
        <div class="container cnt-tnar">
            <nav class="navbar navbar-expand-lg navbar-light bg-light tjnav-bar">
                <a href="/trang-chu" class="nav-logo">
                    <img src="@Url.Content("~/Content/assets/img/logojobtran.png")" alt="logo" />
                </a>
                <button class="navbar-toggler tnavbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent">
                    <i class="fa fa-bars icn-res" aria-hidden="true"></i>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    @Html.Action("MenuTop", "Menu")

                    <ul class="navbar-nav mr-auto my-2 my-lg-0 tnav-right tn-nav">
                        <li class="nav-item nav-save">
                            <a class="nav-link" href="/cong-viec-da-luu" style="position: relative; display: inline-block;">
                                <i class="fa-solid fa-bookmark"></i>
                                <span id="checkout_items" class="notification-badge">0</span>
                                <span class="hidden-text">Thông báo</span>
                            </a>
                        </li>


                        <ul class="navbar-nav ml-auto">
                            @if (Request.IsAuthenticated)
                            {
                                using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { @id = "logOffDForm" }))
                                {
                                    @Html.AntiForgeryToken()
                                }

                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown">
                                        <i class="fa fa-user-circle" aria-hidden="true"></i>
                                        @User.Identity.Name
                                    </a>
                                    <div class="dropdown-menu tdropdown" aria-labelledby="navbarDropdown">
                                        <a class="dropdown-item" href="@Url.Action("MyAppliedJobs", "MyApplicant")">Xem danh sách đã ứng tuyển</a>
                                        <a class="dropdown-item" href="/gio-hang">Gói dịch vụ</a>
                                        <a class="dropdown-item" href="/goi-da-mua">Gói dịch vụ đã mua</a>
                                        <a class="dropdown-item" href="/cong-viec-da-luu">Công việc dã lưu</a>
                                        <a class="dropdown-item" href="javascript:document.getElementById('logOffDForm').submit()">Đăng xuất</a>
                                    </div>
                                </li>
                            }
                            else
                            {
                                <li class="nav-item"><a class="nav-link" href="/account/register">Đăng Ký</a></li>
                                <li class="nav-item"><a class="nav-link" href="/account/login">Đăng Nhập</a></li>
                            }
                        </ul>

                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="langDropdown" role="button" data-toggle="dropdown">VI</a>
                            <div class="dropdown-menu tdropdown" aria-labelledby="langDropdown">
                                <a class="dropdown-item" href="#">English</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link btn-employers" href="/Account/Login?returnUrl=/Employer/HomeEm" tabindex="-1" aria-disabled="true">Nhà Tuyển Dụng</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>
    <!-- (end) main nav -->

    <div class="clearfix"></div>

    <!-- main banner -->
    <div class="container-fluid clear-left clear-right">
        <div class="main-banner">
            <div class="banner-image">
                <img src="@Url.Content("~/Content/assets/img/banner2.jpg")" alt="banner-image">
            </div>
        </div>
    </div>
    <!-- (end) main banner -->
    <!-- search section -->
    <div class="container-fluid search-fluid">
        <div class="container">
            <div class="search-wrapper" style="margin-top: -11rem;">
                <ul class="nav nav-tabs search-nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item search-nav-item">
                        <a class="nav-link snav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab">Tìm việc làm</a>
                    </li>
                    <li class="nav-item search-nav-item">
                        <a class="nav-link snav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab">Tìm công ty</a>
                    </li>
                </ul>
                <div class="tab-content search-tab-content" id="myTabContent">
                    @Html.Action("SearchView", "Search")
                </div>
            </div>
        </div>
    </div>
    <!-- (end) search section -->
    <!-- Chat icon & box -->
    <div id="chatIcon" style="position: fixed; bottom: 110px; right: 30px; cursor: pointer; z-index: 1000;">
        <i class="fas fa-comment-dots" style="font-size: 40px; color: #007bff;"></i>
    </div>

    <div id="chatBox" style="display: none; position: fixed; bottom: 160px; right: 60px; width: 300px; height: 400px; background:#fff; border:1px solid #ddd; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.2); z-index:1000; overflow:hidden;">
        <div id="messagesContainer" style="height:85%; overflow-y:auto; padding:10px;"></div>
        <form id="sendMessageForm" style="padding:10px; display:flex; gap:10px;">
            <textarea name="content" required style="flex:1; resize:none; border:1px solid #ddd; border-radius:5px; padding:5px;"></textarea>
            <button type="submit" style="background:#007bff; color:#fff; border:none; padding:5px 10px; border-radius:5px;">Gửi</button>
        </form>
    </div>

    <style>
        #messagesContainer {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message.user {
            background: #007bff;
            color: #fff;
            text-align: right;
            padding: 10px;
            border-radius: 15px;
            align-self: flex-end;
            max-width: 70%;
            word-wrap: break-word;
        }

        .message.admin {
            background: #28a745;
            color: #fff;
            text-align: left;
            padding: 10px;
            border-radius: 15px;
            align-self: flex-start;
            max-width: 70%;
            word-wrap: break-word;
        }
    </style>

    <script>
        // chat ajax (these run after jQuery so placed here but will rely on jQuery loaded in footer)
        function loadMessages() {
            if (typeof $ === 'undefined') return;
            $.ajax({
                url: '@Url.Action("GetMessages", "Message")',
                type: 'GET',
                success: function (response) {
                    var messagesContainer = document.getElementById("messagesContainer");
                    messagesContainer.innerHTML = "";
                    if (response && response.length) {
                        response.forEach(function (message) {
                            var el = document.createElement("div");
                            el.className = (message.Sender === "Bạn") ? "message user" : "message admin";
                            el.innerHTML = '<strong>' + message.Sender + ':</strong> ' + message.Content;
                            messagesContainer.appendChild(el);
                        });
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    }
                }
            });
        }

        setInterval(function () {
            var chatBox = document.getElementById("chatBox");
            if (chatBox && chatBox.style.display === "block") loadMessages();
        }, 3000);

        document.getElementById("chatIcon").onclick = function () {
            var chatBox = document.getElementById("chatBox");
            if (chatBox.style.display === "none" || chatBox.style.display === "") { chatBox.style.display = "block"; loadMessages(); } else { chatBox.style.display = "none"; }
        };

        document.getElementById("sendMessageForm").onsubmit = function (event) {
            event.preventDefault();
            var content = document.querySelector("textarea[name='content']").value.trim();
            if (content === "") return;
            if (typeof $ === 'undefined') return;
            $.ajax({
                url: '@Url.Action("SendMessage", "Message")',
                type: 'POST',
                data: { content: content },
                success: function (response) {
                    if (response && response.success) {
                        var messagesContainer = document.getElementById("messagesContainer");
                        var newMessage = document.createElement("div");
                        newMessage.className = "message user";
                        newMessage.innerHTML = "<strong>Bạn:</strong> " + response.message;
                        messagesContainer.appendChild(newMessage);
                        document.querySelector("textarea[name='content']").value = "";
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    } else {
                        alert("Gửi tin nhắn thất bại. Vui lòng đăng nhập!");
                    }
                }
            });
        };
    </script>

    @RenderBody()

    <!-- job support -->
    <div class="container-fluid job-support-wrapper">
        <div class="container-fluid job-support-wrap">
            <div class="container job-support">
                <div class="row">
                    <div class="col-md-6 col-sm-12 col-12">
                        <ul class="spp-list">
                            <li><span><i class="fa fa-question-circle pr-2 icsp"></i>Hỗ trợ nhà tuyển dụng:</span></li>
                            <li><span><i class="fa fa-phone pr-2 icsp"></i>@SettingHelper.GetValue("SettingHotline")</span></li>
                        </ul>
                    </div>
                    @Html.Action("Partial_Subcrice", "Home")
                </div>
            </div>
        </div>
        <button id="backToTop" class="back-to-top" title="Quay lại đầu trang">↑</button>
    </div>

    <!-- footer content -->
    <div class="container-fluid footer-wrap clear-left clear-right">
        <div class="container footer">
            <div class="row">
                <div class="col-md-4 col-sm-8 col-12">
                    <h2 class="footer-heading"><span>Về chúng tôi</span></h2>
                    <p class="footer-content">Nền tảng kết nối nhà tuyển dụng và ứng viên nhanh chóng, hiệu quả và tối ưu chi phí.</p>
                    <ul class="footer-contact">
                        <li><a href="#"><i class="fa fa-phone fticn"></i> +123 456 7890</a></li>
                        <li><a href="#"><i class="fa fa-envelope fticn"></i> hello@123.com</a></li>
                        <li><a href="#"><i class="fa fa-map-marker fticn"></i> Ninh kiều, TP.Cần Thơ</a></li>
                    </ul>
                </div>
                @*<div class="col-md-2 col-sm-4 col-12">
                    <h2 class="footer-heading">
                        <span>Ngôn ngữ nổi bật</span>
                    </h2>
                    <ul class="footer-list">
                        <li><a href="#">Javascript</a></li>
                        <li><a href="#">Java</a></li>
                        <li><a href="#">Frontend</a></li>
                        <li><a href="#">SQL Server</a></li>
                        <li><a href="#">.NET</a></li>
                    </ul>
                </div>*@
                <div class="col-md-2 col-sm-6 col-12">
                    <h2 class="footer-heading">
                        <span>Tất cả ngành nghề</span>
                    </h2>
                    <ul class="footer-list">
                        <li><a href="#">Lập trình viên</a></li>
                        <li><a href="#">Kiểm thử phần mềm</a></li>
                        <li><a href="#">Kỹ sư cầu nối</a></li>
                        <li><a href="#">Quản lý dự án</a></li>
                    </ul>
                </div>
                <div class="col-md-4 col-sm-6 col-12">
                    <h2 class="footer-heading"><span>Ngành nghề</span></h2>
                    <ul class="footer-list">
                        <li><a href="#">Bất động sản</a></li>
                        <li><a href="#">Công nghệ thông tin</a></li>
                    </ul>
                </div>

                <div class="col-md-4 col-sm-12 col-12">
                    <h2 class="footer-heading"><span>Tất cả tỉnh thành</span></h2>
                    <ul class="footer-list">
                        <li><a href="#">Hồ Chí Minh</a></li>
                        <li><a href="#">Hà Nội</a></li>
                        <li><a href="#">Đà Nẵng</a></li>
                        <li><a href="#">Buôn Ma Thuột</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <footer class="container-fluid copyright-wrap">
        <div class="container copyright">
            <p class="copyright-content">Copyright © 2024 <a href="#"> Now<b>Jobs</b></a>. All Right Reserved.</p>
        </div>
    </footer>

    <!-- ===== SCRIPTS (Footer, correct order) ===== -->
    <!-- 1) jQuery FULL (only one) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>

    <!-- 2) Unobtrusive ajax (if used) -->
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.min.js")"></script>

    <!-- 3) Popper + Bootstrap JS -->
    <script src="@Url.Content("~/Content/assets/js/popper.min.js")"></script>
    <script src="@Url.Content("~/Content/assets/js/bootstrap.min.js")"></script>

    <!-- 4) Plugin JS -->
    <script src="@Url.Content("~/Content/assets/js/select2.min.js")"></script>
    <script src="@Url.Content("~/Content/assets/js/owlcarousel/owl.carousel.js")"></script>

    <!-- 5) Readmore (must be after jQuery) -->
    <script src="@Url.Content("~/Content/assets/js/readmore.js")"></script>

    <!-- 6) Validation -->
    <script src="@Url.Content("~/Scripts/jquery.validate.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")"></script>

    <!-- 7) Your custom scripts -->
    <script src="@Url.Content("~/Scripts/jsSaveJob.js")"></script>
    <script src="@Url.Content("~/Scripts/JsShopping.js")"></script>
    <script src="@Url.Content("~/Content/assets/js/jobdata.js")"></script>

    <!-- 8) Init scripts -->
    <script type="text/javascript">
        $(document).ready(function () {
            console.log('jQuery:', $.fn.jquery);
            console.log('readmore:', typeof $.fn.readmore);
            console.log('animate:', typeof $.fn.animate);

            if (typeof $.fn.readmore === 'function') {
                $('.catelog-list').readmore({
                    speed: 75,
                    maxHeight: 150,
                    moreLink: '<a href="javascript:void(0)">Xem thêm<i class="fa fa-angle-down pl-2"></i></a>',
                    lessLink: '<a href="javascript:void(0)">Rút gọn<i class="fa fa-angle-up pl-2"></i></a>'
                });
            } else {
                console.warn('Readmore chưa load. Kiểm tra ~/Content/assets/js/readmore.js');
            }
        });
    </script>

    @RenderSection("scripts", required: false)

</body>
</html>
